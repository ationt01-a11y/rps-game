<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹¤ì‹œê°„ ê°€ìœ„ë°”ìœ„ë³´ ëŒ€ê²°</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 50px; background: #f8f9fa; }
        .choice-btn { font-size: 30px; padding: 20px; margin: 10px; cursor: pointer; border: none; border-radius: 10px; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .choice-btn:hover { background: #e9ecef; }
        #status { font-size: 1.2rem; color: #007bff; margin: 20px; font-weight: bold; }
        #result { font-size: 2rem; margin-top: 30px; }
        strong { color: #e91e63; }
    </style>
</head>
<body>
    <h1>âš”ï¸ ì˜¨ë¼ì¸ ê°€ìœ„ë°”ìœ„ë³´</h1>
    <div id="status">ìƒëŒ€ë°©ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>
    
    <div id="game-buttons">
        <button class="choice-btn" onclick="makeChoice('ê°€ìœ„')">âœŒï¸</button>
        <button class="choice-btn" onclick="makeChoice('ë°”ìœ„')">âœŠ</button>
        <button class="choice-btn" onclick="makeChoice('ë³´')">âœ‹</button>
    </div>

    <div id="result"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    // 1. Firebase ì„¤ì • (ì…ë ¥í•˜ì‹  ì •ë³´ ê·¸ëŒ€ë¡œ ìœ ì§€)
    const firebaseConfig = {
      apiKey: "AIzaSyBj9_ZYpq3t_K4mM6ESfvFIK2zh03dFI6Q",
      authDomain: "rps-multi-53875.firebaseapp.com",
      databaseURL: "https://rps-multi-53875-default-rtdb.firebaseio.com",
      projectId: "rps-multi-53875",
      storageBucket: "rps-multi-53875.firebasestorage.app",
      messagingSenderId: "1052388926633",
      appId: "1:1052388926633:web:481cade994c35a4606f5b8"
    };

    // 2. Firebase ì´ˆê¸°í™”
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // 3. í”Œë ˆì´ì–´ ì„¤ì •
    const playerId = prompt("í”Œë ˆì´ì–´ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (1 ë˜ëŠ” 2)");
    const myPath = `game/player${playerId}`;

    // 4. ì„ íƒ í•¨ìˆ˜ (ë²„íŠ¼ í´ë¦­ ì‹œ)
    window.makeChoice = function(choice) {
        update(ref(db, myPath), { choice: choice });
        document.getElementById('status').innerText = `ë‹¹ì‹ ì˜ ì„ íƒ: ${choice}. ìƒëŒ€ë°©ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...`;
    };

    // 5. ìŠ¹íŒ¨ íŒì • ë¡œì§ í•¨ìˆ˜
    function getGameResult(me, opponent) {
        if (me === opponent) return "ğŸ¤ ë¬´ìŠ¹ë¶€ì…ë‹ˆë‹¤!";
        if (
            (me === 'ê°€ìœ„' && opponent === 'ë³´') ||
            (me === 'ë°”ìœ„' && opponent === 'ê°€ìœ„') ||
            (me === 'ë³´' && opponent === 'ë°”ìœ„')
        ) return "ğŸ‰ ë‹¹ì‹ ì´ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!";
        return "ğŸ’€ ë‹¹ì‹ ì´ íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤...";
    }

    // 6. ì‹¤ì‹œê°„ ë°ì´í„° ê°ì‹œ (ì „ì²´ ê²Œì„ ìƒí™©)
    onValue(ref(db, 'game'), (snapshot) => {
        const gameData = snapshot.val();
        if (!gameData) return;

        const p1 = gameData.player1?.choice;
        const p2 = gameData.player2?.choice;

        // ë‘ í”Œë ˆì´ì–´ ëª¨ë‘ ì„ íƒí–ˆì„ ë•Œ ê²°ê³¼ ì¶œë ¥
        if (p1 && p2) {
            const myChoice = (playerId === '1') ? p1 : p2;
            const opponentChoice = (playerId === '1') ? p2 : p1;
            const resultText = getGameResult(myChoice, opponentChoice);
            
            document.getElementById('status').innerText = "ê²Œì„ ì¢…ë£Œ!";
            document.getElementById('result').innerHTML = `
                ë‚˜: ${myChoice} vs ìƒëŒ€: ${opponentChoice}<br>
                <strong>${resultText}</strong><br>
                <button onclick="resetGame()" style="margin-top:20px; padding:10px;">ë‹¤ì‹œ í•˜ê¸°</button>
            `;
        }
    });

    // 7. ê²Œì„ ë¦¬ì…‹ í•¨ìˆ˜
    window.resetGame = function() {
        update(ref(db, 'game/player1'), { choice: null });
        update(ref(db, 'game/player2'), { choice: null });
        document.getElementById('result').innerHTML = "";
        document.getElementById('status').innerText = "ìƒˆ ê²Œì„ ì‹œì‘! ì„ íƒí•´ ì£¼ì„¸ìš”.";
    };
</script>
</body>
</html>